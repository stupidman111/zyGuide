
# 使TCP连接安全-SSL

* SSL使通信双方在SSL握手时就密码算法取得一致。
* 在握手阶段，双发彼此发送`不重数`，该数会用于生成会话密匙。

* SSL握手过程如下：
	1.客户端发送它所支持的密码算法的列表，以及一个`不重数`；
	2.服务端从客户端所支持的密码算法列表中选择一种对称算法、一种公钥算法、一种MAC算法，然后将服务端的证书、所选择的算法、一个`不重数`返回给客户端；
	3.客户端通过本地所存储的权威机构公钥解密证书获取服务端的公钥，生成一个`前主密钥PMS`，用服务端的公钥加密该前主密钥，并将加密的PMS发生给服务器；
	4.双方使用相同的密匙导出函数（该函数可能是SSL标准定义的）从PMS和两个不重数中计算出`主密匙MS`。然后该MS被切片，以生成两个密码和两个MAC密匙。之后，客户端和服务端之间发送的所有报文都被加密和鉴别；
	5.客户端发送所有握手报文的一个MAC；
	6.服务端发送所有握手报文的一个MAC；

> 5、6阶段的作用：验证握手是否被篡改：
> 	比如客户端发送所支持的密码算法列表时，中间服务器拦截了，并剔除掉加密强度高的算法，迫使服务器端只能选择加密强度低的算法。为了防止这种篡改，双方在最后将之前自己所发生的握手报文生成MAC供对方校验，验证双方所收到的报文是否被篡改过。