

## 发布与订阅消息系统

* 发布与订阅消息系统概念：消息的发布者不会直接把消息发送给接受者，这是发布与订阅消息系统的一个特点，而是以某种方式对消息进行分类，订阅者订阅分类，以便接收特定类型的消息。发布者与订阅者之间一般有一个broker。
* 消息：Kakfa中消息就是字节数组，消息被分批次写入Kafka
* 主题-`Topic`：消息按照主题进行分类，主题可以继续划分为多个`分区`。
* 分区-`Partition`：一个分区就是一个提交日志，消息以追加的方式写入分区。

> 注意：同一个主题下可以有多个分区，每个分区可以分布在不同的broker上，也就意味着一个主题可以横跨多个broker；

* 生产者（发布者）与消费者（订阅者）的概念：Kafka的客户端根据数据的流动方向可以划分为生产者与消费者；
* 生产者：发布消息到某个特定的主题上，默认情况下会负载均衡地选择到一个分区上，也可以通过消息键和分区器指定到哪个分区；
* 消费者：订阅一个或多个主题，按消息的生成顺序来读取，通过检查消息的`偏移量`来区分已经读过的消息；
* 偏移量：一个不断递增的整数值，每个分区内偏移量唯一，消费者将每个分区最后读取的消息偏移量保存在zookeeper或kafka上，若消费者关闭或者重启，对锁订阅主题的分区的读取状态不会丢失；

* broker和集群的概念：一个独立的Kafka服务器称为broker，多个broker组成的集群称为Kafka集群；
* broker：
	* 负责接收来自发布者的消息，为消息设置偏移量，并提交到磁盘保存；
	* 负责为订阅者提供服务，对读取的分区的请求作出响应，返回已经提交到磁盘的消息；
* 集群控制器（leader）：每个集群选举出一个broker作为集群控制器；
* 在集群中，分区若从属于某个broker，那么这个broker称为该分区的`首领`；
* 在集群中，一个分区可以分配给多个broker，此时就会发生`分区复制`，这种复制为分区提供了消息冗余，若有一个broker失效，其他broker可以接管领导权；

* 保留消息的概念：Kafka broker可以设置消息保留策略；
	* 默认的消息保留策略：保留一段时间或者保留消息达到一定字节数才删除；

* Kafka多集群的概念：

* Why Kafka？
	* 多个生产者
	* 多个消费者
	* 基于磁盘的数据存储
	* 伸缩性
	* 高性能

* 使用场景：
	* 活动跟踪：
	* 传递消息：
	* 度量指标和日志记录：
	* 提交日志：
	* 流处理：
